# MPC Demo - æœ¬åœ°çƒ­é’±åŒ…æ¼”ç¤ºé¡¹ç›®

ä¸€ä¸ªåŸºäº Go-Zero æ¡†æ¶æ„å»ºçš„å¤šåŠŸèƒ½åŒºå—é“¾é’±åŒ… API æœåŠ¡ï¼Œé›†æˆäº† LI.FI è·¨é“¾åè®®ï¼Œæä¾›å®Œæ•´çš„é’±åŒ…æ“ä½œã€ä»£å¸äº¤æ¢ã€è·¨é“¾è½¬è´¦å’Œæˆæƒç®¡ç†åŠŸèƒ½ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

### ğŸ” é’±åŒ…ç®¡ç†
- **é’±åŒ…åˆå§‹åŒ–** - åˆ›å»ºå’Œç®¡ç†ä»¥å¤ªåŠå…¼å®¹é’±åŒ…
- **ç§é’¥ç®¡ç†** - å®‰å…¨çš„ç§é’¥å­˜å‚¨å’Œæ£€ç´¢
- **å¤šé“¾æ”¯æŒ** - æ”¯æŒ BSCã€ETHã€Polygonã€Arbitrumã€Optimismã€Base ç­‰ä¸»æµé“¾

### ğŸ’¸ äº¤æ˜“åŠŸèƒ½
- **åŸç”Ÿè½¬è´¦** - æ”¯æŒ ETHã€BNB ç­‰åŸç”Ÿä»£å¸è½¬è´¦
- **ERC20 è½¬è´¦** - æ”¯æŒæ‰€æœ‰æ ‡å‡† ERC20 ä»£å¸è½¬è´¦
- **æ™ºèƒ½ Gas ä¼°ç®—** - åŠ¨æ€ Gas ä»·æ ¼å’Œé™åˆ¶ä¼˜åŒ–
- **äº¤æ˜“çŠ¶æ€è¿½è¸ª** - å®Œæ•´çš„äº¤æ˜“ç¡®è®¤å’ŒçŠ¶æ€ç›‘æ§

### ğŸ”„ ä»£å¸äº¤æ¢ (Swap)
- **LI.FI é›†æˆ** - ä½¿ç”¨ LI.FI åè®®è·å¾—æœ€ä¼˜äº¤æ¢è·¯ç”±
- **æ™ºèƒ½ Approve** - è‡ªåŠ¨æ£€æŸ¥å’Œç®¡ç†ä»£å¸æˆæƒ
- **æ»‘ç‚¹ä¿æŠ¤** - å¯é…ç½®çš„æ»‘ç‚¹ä¿æŠ¤æœºåˆ¶
- **å¤š DEX èšåˆ** - è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜çš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€

### ğŸŒ‰ è·¨é“¾è½¬è´¦ (Bridge)
- **å¤šé“¾æ¡¥æ¥** - æ”¯æŒä¸»æµåŒºå—é“¾ä¹‹é—´çš„èµ„äº§è·¨é“¾
- **LI.FI æœ€ä½³å®è·µ** - é›†æˆå®˜æ–¹æ¨èçš„ä¼˜åŒ–å‚æ•°
- **çŠ¶æ€è½®è¯¢** - å®æ—¶è·Ÿè¸ªè·¨é“¾äº¤æ˜“è¿›åº¦
- **é‡è¯•æœºåˆ¶** - è‡ªåŠ¨å¤„ç†ç½‘ç»œå¼‚å¸¸å’Œäº¤æ˜“å¤±è´¥

### ğŸ”‘ æˆæƒç®¡ç† (Approve)
- **æˆæƒæ£€æŸ¥** - æŸ¥è¯¢ä»£å¸å¯¹ç‰¹å®šåˆçº¦çš„æˆæƒé¢åº¦
- **æ™ºèƒ½æˆæƒ** - æ”¯æŒæ— é™æˆæƒå’ŒæŒ‡å®šé‡‘é¢æˆæƒ
- **æ‰¹é‡æŸ¥è¯¢** - ä¸€æ¬¡æŸ¥è¯¢å¤šä¸ªä»£å¸çš„æˆæƒçŠ¶æ€
- **æˆæƒæ’¤é”€** - å®‰å…¨æ’¤é”€ä¸éœ€è¦çš„ä»£å¸æˆæƒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Go 1.19+
- PostgreSQL 12+
- ç¨³å®šçš„ç½‘ç»œè¿æ¥ï¼ˆç”¨äº RPC è°ƒç”¨ï¼‰

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd mpc_demo
```

2. **å®‰è£…ä¾èµ–**
```bash
go mod tidy
```

3. **é…ç½®æ•°æ®åº“**
```bash
# åˆ›å»º PostgreSQL æ•°æ®åº“
createdb testdb

# é…ç½®æ•°æ®åº“è¿æ¥ï¼ˆç¼–è¾‘ etc/demo.yamlï¼‰
```

4. **å¯åŠ¨æœåŠ¡**
```bash
go run main.go
```

æœåŠ¡å°†åœ¨ `http://localhost:8888` å¯åŠ¨

## ğŸ“‹ API æ¥å£æ–‡æ¡£

### é’±åŒ…ç®¡ç†

#### åˆå§‹åŒ–é’±åŒ…
```http
POST /api/wallet_init
Content-Type: application/json

{
  "address": "0x...",
  "private_key": "0x..."
}
```

### äº¤æ˜“æ“ä½œ

#### å‘é€äº¤æ˜“
```http
POST /api/transaction/send
Content-Type: application/json

{
  "from_address": "0x...",
  "to_address": "0x...",
  "chain": "BSC",
  "from_token": "0x0000000000000000000000000000000000000000",
  "to_token": "0x0000000000000000000000000000000000000000",
  "amount": "1000000000000000000"
}
```

#### ä»£å¸äº¤æ¢
```http
POST /api/transaction/swap
Content-Type: application/json

{
  "from_address": "0x...",
  "to_address": "0x...",
  "chain": "BSC",
  "from_token": "0x0000000000000000000000000000000000000000",
  "to_token": "0x55d398326f99059fF775485246999027B3197955",
  "amount": "10000000000000"
}
```

### è·¨é“¾è½¬è´¦

#### è·å–è·¨é“¾æŠ¥ä»·
```http
POST /api/bridge/quote
Content-Type: application/json

{
  "from_chain": 56,
  "to_chain": 137,
  "from_token": "0x55d398326f99059fF775485246999027B3197955",
  "to_token": "0xc2132D05D31c914a87C6611C10748AEb04B58e8F",
  "from_amount": "1000000000000000",
  "from_address": "0x...",
  "to_address": "0x...",
  "order": "FASTEST"
}
```

#### æ‰§è¡Œè·¨é“¾è½¬è´¦
```http
POST /api/bridge/wrap
Content-Type: application/json

{
  "from_address": "0x...",
  "from_chain": 56,
  "to_chain": 137,
  "from_token": "0x55d398326f99059fF775485246999027B3197955",
  "to_token": "0xc2132D05D31c914a87C6611C10748AEb04B58e8F",
  "amount": "1000000000000000",
  "to_address": "0x...",
  "order": "CHEAPEST"
}
```

#### æŸ¥è¯¢è·¨é“¾çŠ¶æ€
```http
POST /api/bridge/status
Content-Type: application/json

{
  "tx_hash": "0x..."
}
```

### æˆæƒç®¡ç†

#### æ£€æŸ¥æˆæƒé¢åº¦
```http
POST /api/transaction/check_allowance
Content-Type: application/json

{
  "token_address": "0x55d398326f99059fF775485246999027B3197955",
  "owner_address": "0x...",
  "spender_address": "0x1231DEB6f5749EF6cE6943a275A1D3E7486F4EaE",
  "chain": "BSC"
}
```

#### æˆæƒä»£å¸
```http
POST /api/transaction/approve
Content-Type: application/json

{
  "token_address": "0x55d398326f99059fF775485246999027B3197955",
  "spender_address": "0x1231DEB6f5749EF6cE6943a275A1D3E7486F4EaE",
  "owner_address": "0x...",
  "amount": "max",
  "chain": "BSC"
}
```

#### æ’¤é”€æˆæƒ
```http
POST /api/transaction/revoke
Content-Type: application/json

{
  "token_address": "0x55d398326f99059fF775485246999027B3197955",
  "spender_address": "0x1231DEB6f5749EF6cE6943a275A1D3E7486F4EaE",
  "owner_address": "0x...",
  "chain": "BSC"
}
```

## âš™ï¸ é…ç½®æ–‡ä»¶

### etc/demo.yaml
```yaml
Name: demo-api
Host: 0.0.0.0
Port: 8888

Postgres:
  DSN: "postgres://admin:123456@localhost:5432/testdb?sslmode=disable"

Lifi:
  ApiUrl: "https://li.quest/v1"

Chains:
  BSC:
    Name: "Binance Smart Chain Mainnet"
    RpcUrl: "https://bsc-rpc.publicnode.com"
    ChainId: 56
  ETH:
    Name: "Ethereum Mainnet"
    RpcUrl: "https://mainnet.infura.io/v3/your-infura-id"
    ChainId: 1
  Polygon:
    Name: "Polygon Mainnet"
    RpcUrl: "https://polygon-rpc.com"
    ChainId: 137
```

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
mpc_demo/
â”œâ”€â”€ cli/                    # å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ etc/                    # é…ç½®æ–‡ä»¶
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/            # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ constant/          # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ handler/           # HTTP å¤„ç†å™¨
â”‚   â”œâ”€â”€ logic/             # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ approve_logic.go    # æˆæƒç®¡ç†
â”‚   â”‚   â”œâ”€â”€ bridge_logic.go     # è·¨é“¾è½¬è´¦
â”‚   â”‚   â”œâ”€â”€ send_logic.go       # æ™®é€šè½¬è´¦
â”‚   â”‚   â”œâ”€â”€ swap_logic.go       # ä»£å¸äº¤æ¢
â”‚   â”‚   â”œâ”€â”€ transaction_logic.go # é€šç”¨äº¤æ˜“
â”‚   â”‚   â””â”€â”€ wallet_logic.go     # é’±åŒ…ç®¡ç†
â”‚   â”œâ”€â”€ mid/               # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ model/             # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ svc/               # æœåŠ¡ä¸Šä¸‹æ–‡
â”‚   â””â”€â”€ types/             # ç±»å‹å®šä¹‰
â”œâ”€â”€ test/                  # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ main.go               # å…¥å£æ–‡ä»¶
â””â”€â”€ README.md             # é¡¹ç›®æ–‡æ¡£
```

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯

- **æ¡†æ¶**: Go-Zero (å¾®æœåŠ¡æ¡†æ¶)
- **æ•°æ®åº“**: PostgreSQL (é’±åŒ…æ•°æ®å­˜å‚¨)
- **åŒºå—é“¾**: go-ethereum (ä»¥å¤ªåŠå®¢æˆ·ç«¯)
- **è·¨é“¾**: LI.FI Protocol (è·¨é“¾èšåˆåè®®)
- **API**: RESTful API (JSON æ ¼å¼)

## ğŸŒŸ ç‰¹è‰²åŠŸèƒ½

### LI.FI é›†æˆä¼˜åŒ–
- **æœ€ä½³å®è·µå‚æ•°**: é›†æˆå®˜æ–¹æ¨èçš„ä¼˜åŒ–é…ç½®
- **æ™ºèƒ½è·¯ç”±**: è‡ªåŠ¨é€‰æ‹©æœ€å¿«æˆ–æœ€ä¾¿å®œçš„è·¨é“¾è·¯ç”±
- **æ—¶é—´ç­–ç•¥**: ä¼˜åŒ–çš„é‡è¯•å’Œç­‰å¾…ç­–ç•¥
- **è´¹ç”¨ä¼˜åŒ–**: æ™ºèƒ½ Gas ä¼°ç®—å’Œæ»‘ç‚¹ä¿æŠ¤

### æ™ºèƒ½é”™è¯¯å¤„ç†
- **RPC å®¹é”™**: è‡ªåŠ¨å¤„ç† RPC èŠ‚ç‚¹çš„è¯¯å¯¼æ€§é”™è¯¯
- **é‡è¯•æœºåˆ¶**: ç½‘ç»œå¼‚å¸¸æ—¶çš„è‡ªåŠ¨é‡è¯•
- **çŠ¶æ€è¿½è¸ª**: å®Œæ•´çš„äº¤æ˜“çŠ¶æ€ç›‘æ§å’Œè½®è¯¢

### å®‰å…¨ç‰¹æ€§
- **ç§é’¥ä¿æŠ¤**: å®‰å…¨çš„ç§é’¥å­˜å‚¨å’Œç®¡ç†
- **æˆæƒç®¡ç†**: ç²¾ç¡®çš„ä»£å¸æˆæƒæ§åˆ¶
- **äº¤æ˜“éªŒè¯**: å®Œæ•´çš„äº¤æ˜“å‚æ•°éªŒè¯å’Œç¡®è®¤

## ğŸ“Š æ”¯æŒçš„åŒºå—é“¾

| é“¾åç§° | Chain ID | ä¸»ç½‘/æµ‹è¯•ç½‘ | RPC çŠ¶æ€ |
|--------|----------|-------------|----------|
| BSC | 56 | ä¸»ç½‘ | âœ… å·²é…ç½® |
| Ethereum | 1 | ä¸»ç½‘ | âš ï¸ éœ€é…ç½® |
| Polygon | 137 | ä¸»ç½‘ | âš ï¸ éœ€é…ç½® |
| Arbitrum | 42161 | ä¸»ç½‘ | âš ï¸ éœ€é…ç½® |
| Optimism | 10 | ä¸»ç½‘ | âš ï¸ éœ€é…ç½® |
| Base | 8453 | ä¸»ç½‘ | âš ï¸ éœ€é…ç½® |

## ğŸ›¡ï¸ å®‰å…¨æé†’

âš ï¸ **é‡è¦å®‰å…¨æé†’**ï¼š
- è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºé¡¹ç›®ï¼Œ**ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å­˜å‚¨å¤§é‡èµ„é‡‘**
- ç§é’¥ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œä»…é€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•
- ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨ç¡¬ä»¶é’±åŒ…æˆ–ä¸“ä¸šçš„å¯†é’¥ç®¡ç†æœåŠ¡
- å®šæœŸå¤‡ä»½é’±åŒ…æ•°æ®å’Œç§é’¥ä¿¡æ¯

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ·»åŠ æ–°çš„åŒºå—é“¾æ”¯æŒï¼Ÿ
A: åœ¨ `etc/demo.yaml` ä¸­æ·»åŠ æ–°çš„é“¾é…ç½®ï¼Œå¹¶åœ¨ç›¸å…³é€»è¾‘æ–‡ä»¶ä¸­æ·»åŠ é“¾IDæ˜ å°„ã€‚

### Q: äº¤æ˜“å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥ Gas ä»·æ ¼ã€ç½‘ç»œçŠ¶æ€å’Œè´¦æˆ·ä½™é¢ã€‚ç³»ç»ŸåŒ…å«è‡ªåŠ¨é‡è¯•æœºåˆ¶ã€‚

### Q: å¦‚ä½•æ›´æ¢ RPC èŠ‚ç‚¹ï¼Ÿ
A: ä¿®æ”¹ `etc/demo.yaml` ä¸­å¯¹åº”é“¾çš„ `RpcUrl` é…ç½®ã€‚

### Q: è·¨é“¾äº¤æ˜“å¡ä½äº†æ€ä¹ˆåŠï¼Ÿ
A: ä½¿ç”¨ `/api/bridge/status` æ¥å£æŸ¥è¯¢äº¤æ˜“çŠ¶æ€ï¼ŒLI.FI åè®®ä¼šè‡ªåŠ¨å¤„ç†å¤§éƒ¨åˆ†å¼‚å¸¸æƒ…å†µã€‚

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™å®ƒä¸€ä¸ª Starï¼**
